\documentclass [xcolor=svgnames, t] {beamer} 
\usepackage[utf8]{inputenc}
\usepackage{booktabs, comment} 
\usepackage[absolute, overlay]{textpos} 
\useoutertheme{infolines} 
\setbeamercolor{title in head/foot}{bg=internationalorange}
\setbeamercolor{author in head/foot}{bg=dodgerblue}
\usepackage{csquotes}
\usepackage[style=verbose-ibid,backend=bibtex]{biblatex}
\bibliography{bibfile}
\usepackage{amsmath}
\usepackage[makeroom]{cancel}
\usepackage{textpos}
\usepackage{tikz}
\usepackage{listings}
\graphicspath{ {./figures/} }
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
}

\usetheme{Madrid}
\definecolor{myuniversity}{RGB}{0, 60, 113}
\definecolor{internationalorange}{RGB}{231, 93,  42}
 	\definecolor{dodgerblue}{RGB}{0, 119,202}
\usecolortheme[named=myuniversity]{structure}

\graphicspath{ {./figures/} }

\title[IOB-SoC Presentation]{IOB-SoC}
\subtitle{A RISC-V-based System on Chip}
\institute[IObundle Lda]{IObundle Lda.\\The Architecture for an Agile World}
\titlegraphic{\includegraphics[height=2.5cm]{Logo.png}}
\author[Jos√© T. de Sousa]{Jos\'e T. de Sousa}
\institute[IObundle Lda]{IObundle Lda}
\date{\today}


\addtobeamertemplate{navigation symbols}{}{%
    \usebeamerfont{footline}%
    \usebeamercolor[fg]{footline}%
    \hspace{1em}%
    \insertframenumber/\inserttotalframenumber
}

\begin{document}

\begin{frame}
 \titlepage   
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\logo{\includegraphics[scale=0.2]{Logo.png}~%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}{Outline}
\begin{center}
   \begin{itemize}
     \item Introduction
     \item Project setup
     \item Project editing guidelines
     \item Getting started with the timer IP hardware design
     \item Edit the hardware definitions file {\tt system.vh}
     \item Instantiate the timer IP in file {\tt rtl/src/system.v}
     \item Add the timer IP firmware
     \item Edit file {\tt firmware.c} to drive the timer IP
     \item Edit the Makefile to compile the timer IP firmware
     \item Setup RTL simulation using the Icarus Verilog simulator
     \item Simulate the system
     \item Conclusions and future work
 \end{itemize} 
\end{center}
\end{frame}


\begin{frame}{Introduction}
\begin{center}
    \begin{itemize}
      \item Building processor-based systems from scratch is challenging
      \item The IOB-SoC template eases this task
      \item Provides a base Verilog SoC equipped with
        \begin{itemize}
        \item a RISC-V CPU
        \item a memory system including boot ROM, RAM and AXI4 interface to DDR
        \item a UART communications module
        \end{itemize}
      \item Users can add IP cores and software to build more complex SoCs
      \item Here, the addition of a timer IP and its software driver is exemplified
    \end{itemize}
\end{center}
\end{frame}

\begin{frame}{Project setup}
\begin{center}
  \begin{itemize}
    \item Use a Linux machine or VM
    \item Install the latest stable version of the open source Icarus Verilog simulator (\url{iverilog.icarus.com})
    \item Make sure you can access \url{github.com} using an ssh key
    \item At \url{github.com} create your SoC repository ({\it
      my-soc}) using \url{github.com/IObundle/iob-soc} as a
      template
    \item Follow the instructions in the README file to clone the repository in your Linux machine
  \end{itemize}
\end{center}
\end{frame}


\begin{frame}{Create an IP core to instantiate in your SoC}
\begin{itemize}
\item Create a timer IP core or alternatively use a ready-made one and iclude it as a git submodule: at the {\tt iob-soc} root type
  \\{\fontsize{7pt}{10pt} \tt git submodule add git@github.com:IObundle/iob-timer.git submodules/iob-timer}
\item Edit the following lines in the {\tt ./system.mk} file to configure the system as explained in the next slide
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Edit the {\tt ./system.mk} configuration file to declare the new peripheral}
\begin{tiny}
\begin{lstlisting}
#FIRMWARE
FIRM_ADDR_W:=13

#SRAM
SRAM_ADDR_W=13

#DDR
USE_DDR:=0
RUN_DDR:=0
DDR_ADDR_W:=30

#BOOT
USE_BOOT:=0
BOOTROM_ADDR_W:=12

#Number of peripherals
N_SLAVES:=2

#Peripheral IDs (assign serially: 0, 1, 2, etc)
UART:=0
TIMER:=1

#Peripheral paths
UART_DIR=$(SUBMODULES_DIR)/iob-uart
TIMER_DIR=$(SUBMODULES_DIR)/iob-timer


\end{lstlisting}
\end{tiny}
\end{frame}

\begin{frame}[fragile]{Edit the {\tt hardware.mk} and {\tt software.mk} configuration files to import the peripheral's hardware and software}

  {\tt ./hardware/hardware.mk}
  \begin{tiny}
    
    \begin{lstlisting}
include $(ROOT_DIR)/system.mk

# submodules
include $(TIMER_DIR)/hardware/hardware.mk
include $(CPU_DIR)/hardware/hardware.mk
...
    \end{lstlisting}
  \end{tiny}

  {\tt ./software/software.mk}
  \begin{tiny}
    \begin{lstlisting}
define:=-D
include $(ROOT_DIR)/system.mk

#submodules
include $(TIMER_DIR)/software/software.mk
include $(INTERCON_DIR)/software/software.mk
    \end{lstlisting}
  \end{tiny}
\end{frame}


\begin{frame}[fragile]{Instantiate the timer IP in file {\tt rtl/src/system.v}}
\begin{tiny}
\begin{lstlisting}
`timescale 1ns/1ps
`include "system.vh"

module system (

   ...

   time_counter #(.COUNTER_WIDTH(32))
   timer (
          rst(reset_int),
          clk(clk),
          .addr(m_addr[2]),
          .data_in(m_wdata),
          .data_out(s_rdata[`TIMER_BASE]),
          .valid(s_valid[`TIMER_BASE]),
          .ready(s_ready[`TIMER_BASE])
    );

   ...
endmodule
\end{lstlisting}
\end{tiny}
\end{frame}

%\begin{frame}{Add the timer IP software}
%\end{frame}

\begin{frame}[fragile]{Edit the {\tt firmware.c} file to drive the new peripheral}

  {\tt ./software/firmware/firmware.c}
  \begin{tiny}
    \begin{lstlisting}
#include "system.h"
#include "iob-uart.h"
#include "iob_timer.h"

int main()
{ 

  //read timer cycle count
  int cycles = timer_get_count(TIMER_BASE);
  
  uart_init(UART,UART_CLK_FREQ/UART_BAUD_RATE);   

  uart_printf("Hello world!\n");

  uart_txwait();
  
  //read current timer count and compute elapsed time in clock cycles  
  cycles =  timer_get_count(TIMER) - cycles;

  //print the elapsed time and clock frequency
  uart_printf("Execution time: %dus @%dMHz,115200BAUD\n",(time*1000000)/UART_CLK_FREQ);

  uart_txwait();
  return 0;
}
\end{lstlisting}
\end{tiny}
\end{frame}


\begin{frame}[fragile]{Simulate the system}

\begin{itemize}
\item To simulate the system just type\\
  {\tt make} 
\item The firmware, bootloader and system verilog description are compiled as you can see from the printed messages
\item The last prints should look like the following
\end{itemize}

\begin{tiny}
\begin{lstlisting}

IOb-SoC Bootloader:

Reboot CPU and run program...

Hello world!
Total execution time: 1262 us @100MHz
\end{lstlisting}
\end{tiny}

\begin{itemize}
\item Congratulations! You have created your first RISC-V system using IOB-SoC.\\
\end{itemize}

\end{frame}



\begin{frame}{Main memory options}
%\begin{small}
\begin{itemize}
\item The main memory type options are enabled by defining or undefining the {\tt USE\_DDR} and {\tt USE\_BOOT} macros
\item Option 1: place the firmware image in FPGA memory during design compilation
  \begin{itemize}
  \item Do not define either macro: \underline{not reprogrammable}
  \item This option is only valid for FPGA: needs recompilation if firmware changes
  \end{itemize}
\item Option 2: place the firmware in internal RAM
  \begin{itemize}
  \item Define macro {\tt USE\_BOOT} only: \underline {reprogrammable}
  \item This option is valid for FPGA and ASIC
  \item Firmware can be (re)loaded via UART
  \end{itemize}
\item Option 3: place the firmware in external DDR memory
  \begin{itemize}
  \item Define both macros: \underline{reprogrammable}
  \item This option is valid for FPGA and ASIC
  \item Firmware can be (re)loaded via UART
  \item Third party DDR controller IP core is required
  \end{itemize}
\end{itemize}
\end{frame}
%\end{small}




\begin{frame}{Conclusions and future work}

\begin{itemize}
  \item Conclusions
    \begin{itemize}
    \item Presented project and editing guidelines
    \item Designed of a peripheral IP (timer)
    \item Instantiated peripheral in the system 
    \item Designed a simple software driver for the peripheral
    \item Compiled the software
    \item Simulated the system's RTL code running the software in the memories
    \item Presented options for the main memory
    \end{itemize}
  \item Future work
    \begin{itemize}
    \item Non volatile (flash) external memory support
    \item Real Time Operating System (RTOS) 
    \end{itemize}
\end{itemize}

\end{frame}




%\begin{frame}{Introduction}
%\begin{center}
%  \begin{columns}[onlytextwidth]
%    \column{0.5\textwidth}
%    bla
%    \column{0.5\textwidth}
%    \begin{figure}
%      \centering
%       \includegraphics[width=0.9\textwidth]{turb.jpg}
%      \caption{1. Flow visualisation (source: www.bronkhorst.com).}
%      \label{fig:my_label}
%    \end{figure}
%  \end{columns}
%\end{center}
%\end{frame}

\end{document}
